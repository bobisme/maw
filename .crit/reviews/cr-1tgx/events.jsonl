{"ts":"2026-02-19T06:08:50.399184871Z","author":"maw-dev/0/ultra-warden","event":"ReviewCreated","data":{"review_id":"cr-1tgx","jj_change_id":"vpsskopltmpuuvxuyzmrkokmoxltsqtt","initial_commit":"becfdb3263d83efff1daf4dca65be79fdfe9eaac","title":"bd-2sjg.2: maw init brownfield repo setup (existing git repo)","description":"Implements brownfield_init in v2_init.rs for initializing Manifold in an existing git repository.\n\n## What changed\n- Added BrownfieldInitError, BrownfieldInitResult, BrownfieldInitOptions types\n- Added brownfield_init() public function with 12-step initialization flow\n- Added private helpers: bf_verify_git_repo, bf_detect_head_branch, bf_get_dirty_files, bf_get_head_oid, bf_set_bare_mode, bf_clean_root_index, bf_set_epoch_ref, bf_create_default_workspace, bf_clean_root_tracked_files, bf_run_git\n- 18 unit tests covering all acceptance criteria\n\n## Behavior\n1. Verifies .git/ exists (errors on missing)\n2. Verifies valid git repo (git rev-parse --git-dir)\n3. Idempotent: returns early if ws/default/ already exists\n4. Detects dirty working tree (warns, keeps dirty files at root)\n5. Reads current HEAD as epoch0 (errors if no commits)\n6. Detects detached HEAD (warns)\n7. Sets core.bare = true\n8. Removes .git/index (bare mode cleanup)\n9. Creates .manifold/ via layout::init_manifold_dir\n10. Sets refs/manifold/epoch/current = HEAD\n11. Creates ws/default/ via git worktree add --detach\n12. Removes tracked source files from root (dirty files kept)\n13. Updates .gitignore (preserves existing entries)\n\n## Tests (18 passing)\nbrownfield_rejects_missing_git, brownfield_rejects_empty_repo, brownfield_creates_manifold_dir, brownfield_sets_epoch_ref_to_head, brownfield_creates_default_workspace, brownfield_sets_bare_mode, brownfield_removes_tracked_files_from_root, brownfield_cleans_empty_subdirs, brownfield_preserves_gitignore_entries, brownfield_is_idempotent, brownfield_preserves_git_history, brownfield_result_not_initialized_display, brownfield_result_already_initialized_display, brownfield_error_display, brownfield_removes_root_index, brownfield_workspace_at_correct_commit, brownfield_detects_head_branch, brownfield_gitignore_updated"}}
{"ts":"2026-02-19T06:08:50.399320926Z","author":"maw-dev/0/ultra-warden","event":"ReviewersRequested","data":{"review_id":"cr-1tgx","reviewers":["maw-security"]}}
